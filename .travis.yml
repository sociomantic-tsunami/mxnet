# We will use docker to set up our environment, so don't use any particular
# language in Travis itself
language: generic

# Enable docker
sudo: required
services:
    - docker

# Disable automatic submodule fetching ...
git:
    submodules: false

# ... in order to ensure we do a non-shallow submodule fetch
before_install:
    - git fetch --unshallow --tags
    - git submodule update --init --no-recommend-shallow

env:
    global:
        # Make sure beaver is in the PATH
        - PATH="$(git config -f .gitmodules submodule.beaver.path)/bin:$PATH"
        - BEAVER_DOCKER_VARS="LANG=C.UTF_8 LC_ALL=C.UTF-8"
    matrix:
        - DIST=trusty
        - DIST=xenial

install: beaver install

script:
    - beaver make USE_BLAS=openblas USE_OPENCV=0 USE_OPENMP=0
    - beaver make -f makd/Makd.mak pkg

deploy:
    provider: script
    script: beaver bintray upload -d sociomantic-tsunami/mxnet/libmxnet *.deb
    skip_cleanup: true
    on:
        tags: true
